<div class="network-config-page">
  
  <!-- Banner de clasificación global -->
  <div class="classification-banner-global" [class]="'classification-' + currentClassification()">
    <mat-icon>{{ classificationInfo().icon }}</mat-icon>
    <span class="classification-text">
      NIVEL DE CLASIFICACIÓN: {{ classificationInfo().label | uppercase }}
    </span>
    <mat-icon>{{ classificationInfo().icon }}</mat-icon>
  </div>
  
  <!-- Header principal -->
  <div class="config-header">
    <div class="header-content">
      <div class="header-badge">
        <mat-icon>shield</mat-icon>
        <span class="font-mono">SENTINEL-ML // CONFIGURACIÓN DE DEFENSA</span>
      </div>
      <h1 class="header-title font-display">Sistema de Detección de Amenazas</h1>
      <p class="header-subtitle">
        Configure el sistema de detección inteligente para redes de telecomunicaciones militares.
        Siga los pasos del asistente para una integración completa.
      </p>
    </div>
    
    <!-- Indicador de progreso circular -->
    <div class="progress-indicator">
      <div class="progress-circle">
        <svg viewBox="0 0 100 100">
          <circle class="progress-bg" cx="50" cy="50" r="45" />
          <circle 
            class="progress-fill" 
            cx="50" cy="50" r="45"
            [style.stroke]="networkColor()"
            [style.stroke-dashoffset]="283 - (283 * progressPercentage() / 100)" />
        </svg>
        <span class="progress-value font-display">{{ progressPercentage() }}%</span>
      </div>
      <span class="progress-label font-mono">COMPLETADO</span>
    </div>
  </div>
  
  <!-- Stepper visual -->
  <div class="config-stepper">
    @for (step of steps; track trackByStepId($index, step); let last = $last) {
      <div 
        class="step-item" 
        [class]="getStepClass(step)"
        (click)="goToStep(step.id)">
        <div class="step-indicator">
          @if (step.completado) {
            <mat-icon>check</mat-icon>
          } @else {
            <mat-icon>{{ step.icon }}</mat-icon>
          }
        </div>
        <div class="step-content">
          <span class="step-number font-mono">PASO {{ step.id }}</span>
          <span class="step-title">{{ step.titulo }}</span>
          <span class="step-description font-mono">{{ step.descripcion }}</span>
        </div>
      </div>
      @if (!last) {
        <div class="step-connector" [class.completed]="step.completado"></div>
      }
    }
  </div>
  
  <!-- Contenido del paso actual -->
  <div class="config-content" [@stepTransition]="currentStep()">
    
    @switch (currentStep()) {
      
      <!-- ═══════════════════════════════════════════════════════
           PASO 1: SELECCIÓN DE TIPO DE RED
           ═══════════════════════════════════════════════════════ -->
      @case (1) {
        <app-network-type-selector-page
          (networkSelected)="onNetworkSelected($event)"
          (configurationComplete)="onConfigurationComplete($event)">
        </app-network-type-selector-page>
      }
      
      <!-- ═══════════════════════════════════════════════════════
           PASO 2: DESCUBRIMIENTO DE ACTIVOS
           ═══════════════════════════════════════════════════════ -->
      @case (2) {
        <div class="step-content-wrapper" @fadeSlide>
          <div class="step-header">
            <div class="step-icon" [style.background]="networkColor() + '20'" [style.color]="networkColor()">
              <mat-icon>radar</mat-icon>
            </div>
            <div class="step-info">
              <h2 class="step-title-main font-display">Descubrimiento de Activos</h2>
              <p class="step-subtitle">Resultados del escaneo de red para {{ selectedNetwork()?.nombre }}</p>
            </div>
          </div>
          
          <!-- Resumen del escaneo -->
          <div class="discovery-summary card">
            <div class="card-header">
              <h3 class="card-title">
                <mat-icon [style.color]="networkColor()">{{ selectedNetwork()?.icon }}</mat-icon>
                {{ selectedNetwork()?.nombreCorto }} - Resumen de Descubrimiento
              </h3>
              <span class="badge-status success">
                <mat-icon>check_circle</mat-icon>
                Escaneo Completado
              </span>
            </div>
            
            <div class="card-body">
              <!-- Stats del descubrimiento -->
              <div class="discovery-stats">
                <div class="discovery-stat">
                  <mat-icon [style.color]="networkColor()">devices</mat-icon>
                  <span class="stat-value font-display">{{ defenseConfig()?.devicesDetected || selectedNetwork()?.dispositivos }}</span>
                  <span class="stat-label font-mono">DISPOSITIVOS DETECTADOS</span>
                </div>
                <div class="discovery-stat">
                  <mat-icon [style.color]="defenseConfig()?.threatsDetected ? 'var(--danger)' : networkColor()">
                    {{ defenseConfig()?.threatsDetected ? 'warning' : 'verified_user' }}
                  </mat-icon>
                  <span class="stat-value font-display" [class.danger]="defenseConfig()?.threatsDetected">
                    {{ defenseConfig()?.threatsDetected || 0 }}
                  </span>
                  <span class="stat-label font-mono">ALERTAS INICIALES</span>
                </div>
                <div class="discovery-stat">
                  <mat-icon [style.color]="networkColor()">psychology</mat-icon>
                  <span class="stat-value font-display">{{ mlModelsCount() }}</span>
                  <span class="stat-label font-mono">MODELOS ML DISPONIBLES</span>
                </div>
                <div class="discovery-stat">
                  <mat-icon [style.color]="networkColor()">gpp_bad</mat-icon>
                  <span class="stat-value font-display">{{ threatCount() }}</span>
                  <span class="stat-label font-mono">AMENAZAS MONITOREADAS</span>
                </div>
              </div>
              
              <!-- Detalles de la red -->
              <div class="discovery-details">
                <div class="detail-section">
                  <h4 class="section-title font-mono">
                    <mat-icon>info</mat-icon>
                    INFORMACIÓN DE LA RED
                  </h4>
                  <div class="detail-grid">
                    <div class="detail-item">
                      <span class="detail-label">Tipo de Red</span>
                      <span class="detail-value">{{ selectedNetwork()?.nombre }}</span>
                    </div>
                    <div class="detail-item">
                      <span class="detail-label">Entorno</span>
                      <span class="detail-value">{{ selectedNetwork()?.entorno | titlecase }}</span>
                    </div>
                    <div class="detail-item">
                      <span class="detail-label">Velocidad</span>
                      <span class="detail-value">{{ selectedNetwork()?.velocidad }}</span>
                    </div>
                    <div class="detail-item">
                      <span class="detail-label">Cobertura</span>
                      <span class="detail-value">{{ selectedNetwork()?.cobertura }}</span>
                    </div>
                    <div class="detail-item">
                      <span class="detail-label">Latencia Máxima</span>
                      <span class="detail-value">{{ selectedNetwork()?.latenciaMaxima }}</span>
                    </div>
                    <div class="detail-item">
                      <span class="detail-label">Disponibilidad</span>
                      <span class="detail-value">{{ selectedNetwork()?.disponibilidadRequerida }}</span>
                    </div>
                  </div>
                </div>
                
                <div class="detail-section">
                  <h4 class="section-title font-mono">
                    <mat-icon>verified</mat-icon>
                    ESTÁNDARES DE CUMPLIMIENTO
                  </h4>
                  <div class="standards-tags">
                    @for (standard of selectedNetwork()?.estandares; track standard) {
                      <span class="standard-tag">{{ standard }}</span>
                    }
                  </div>
                </div>
              </div>
            </div>
            
            <div class="card-footer">
              <button class="btn-sentinel btn-sentinel-secondary" (click)="previousStep()">
                <mat-icon>arrow_back</mat-icon>
                Anterior
              </button>
              <button 
                class="btn-sentinel btn-sentinel-primary" 
                [style.background]="'linear-gradient(135deg, ' + networkColor() + ', ' + networkColor() + 'cc)'"
                (click)="confirmDiscovery()">
                Confirmar y Continuar
                <mat-icon>arrow_forward</mat-icon>
              </button>
            </div>
          </div>
        </div>
      }
      
      <!-- ═══════════════════════════════════════════════════════
           PASO 3: CONFIGURACIÓN DE POLÍTICAS
           ═══════════════════════════════════════════════════════ -->
      @case (3) {
        <div class="step-content-wrapper" @fadeSlide>
          <div class="step-header">
            <div class="step-icon" [style.background]="networkColor() + '20'" [style.color]="networkColor()">
              <mat-icon>policy</mat-icon>
            </div>
            <div class="step-info">
              <h2 class="step-title-main font-display">Políticas de Seguridad</h2>
              <p class="step-subtitle">Configure las políticas de detección y respuesta para su red</p>
            </div>
          </div>
          
          <div class="policies-container">
            <!-- Panel de políticas -->
            <div class="policies-panel card">
              <div class="card-header">
                <h3 class="card-title">
                  <mat-icon [style.color]="networkColor()">security</mat-icon>
                  Módulos de Detección
                </h3>
                <span class="policies-count font-mono">
                  {{ activePoliciesCount() }} / {{ securityPolicies.length }} ACTIVOS
                </span>
              </div>
              
              <div class="card-body">
                <div class="policies-grid">
                  @for (policy of securityPolicies; track trackByPolicyId($index, policy)) {
                    <div 
                      class="policy-card" 
                      [class.active]="isPolicyActive(policy.id)"
                      [class]="getPolicyLevelClass(policy.nivel)"
                      (click)="togglePolicy(policy.id)">
                      <div class="policy-header">
                        <div class="policy-toggle">
                          <mat-icon>{{ isPolicyActive(policy.id) ? 'check_box' : 'check_box_outline_blank' }}</mat-icon>
                        </div>
                        <div class="policy-info">
                          <span class="policy-name">{{ policy.nombre }}</span>
                          <span class="policy-level font-mono">{{ policy.nivel | uppercase }}</span>
                        </div>
                      </div>
                      <p class="policy-description">{{ policy.descripcion }}</p>
                    </div>
                  }
                </div>
              </div>
            </div>
            
            <!-- Panel de nivel de alerta -->
            <div class="alert-level-panel card">
              <div class="card-header">
                <h3 class="card-title">
                  <mat-icon [style.color]="getAlertLevelColor(alertLevel())">notifications_active</mat-icon>
                  Nivel de Sensibilidad
                </h3>
              </div>
              
              <div class="card-body">
                <p class="alert-description">
                  Define el umbral de sensibilidad para la generación de alertas. 
                  Niveles más altos generan más alertas pero pueden incluir falsos positivos.
                </p>
                
                <div class="alert-levels">
                  @for (level of ['bajo', 'medio', 'alto', 'critico']; track level) {
                    <button 
                      class="alert-level-btn"
                      [class.active]="alertLevel() === level"
                      [style.--level-color]="getAlertLevelColor(level)"
                      (click)="setAlertLevel($any(level))">
                      <mat-icon>
                        {{ level === 'critico' ? 'error' : level === 'alto' ? 'warning' : level === 'medio' ? 'info' : 'check_circle' }}
                      </mat-icon>
                      <span>{{ getAlertLevelLabel(level) }}</span>
                    </button>
                  }
                </div>
                
                <div class="alert-level-info" [style.border-color]="getAlertLevelColor(alertLevel())">
                  <mat-icon [style.color]="getAlertLevelColor(alertLevel())">info</mat-icon>
                  <div class="info-content">
                    @switch (alertLevel()) {
                      @case ('bajo') {
                        <p>Solo alertas de alta confianza. Menor volumen, mayor precisión.</p>
                      }
                      @case ('medio') {
                        <p>Balance entre volumen y precisión. Recomendado para la mayoría de entornos.</p>
                      }
                      @case ('alto') {
                        <p>Mayor sensibilidad. Detecta más amenazas pero requiere más revisión manual.</p>
                      }
                      @case ('critico') {
                        <p>Máxima sensibilidad. Para entornos de alto riesgo donde ninguna amenaza puede pasar desapercibida.</p>
                      }
                    }
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Acciones -->
          <div class="step-actions">
            <button class="btn-sentinel btn-sentinel-secondary" (click)="previousStep()">
              <mat-icon>arrow_back</mat-icon>
              Anterior
            </button>
            <button 
              class="btn-sentinel btn-sentinel-primary"
              [disabled]="activePoliciesCount() === 0"
              [style.background]="'linear-gradient(135deg, ' + networkColor() + ', ' + networkColor() + 'cc)'"
              (click)="confirmPolicies()">
              Confirmar Políticas
              <mat-icon>arrow_forward</mat-icon>
            </button>
          </div>
        </div>
      }
      
      <!-- ═══════════════════════════════════════════════════════
           PASO 4: ACTIVACIÓN DEL SISTEMA
           ═══════════════════════════════════════════════════════ -->
      @case (4) {
        <div class="step-content-wrapper" @fadeSlide>
          
          @if (!configCompleted()) {
            <!-- Estado: Listo para activar o activando -->
            <div class="step-header">
              <div class="step-icon" [style.background]="networkColor() + '20'" [style.color]="networkColor()">
                <mat-icon>power_settings_new</mat-icon>
              </div>
              <div class="step-info">
                <h2 class="step-title-main font-display">Activar SENTINEL-ML</h2>
                <p class="step-subtitle">Revise la configuración y active el sistema de detección</p>
              </div>
            </div>
            
            <!-- Resumen de configuración -->
            <div class="activation-summary card">
              <div class="card-header">
                <h3 class="card-title">
                  <mat-icon [style.color]="networkColor()">summarize</mat-icon>
                  Resumen de Configuración
                </h3>
              </div>
              
              <div class="card-body">
                <div class="summary-grid">
                  <!-- Red -->
                  <div class="summary-section">
                    <h4 class="summary-section-title font-mono">
                      <mat-icon>lan</mat-icon>
                      RED CONFIGURADA
                    </h4>
                    <div class="summary-card" [style.border-color]="networkColor()">
                      <div class="summary-card-icon" [style.background]="networkColor()">
                        <mat-icon>{{ selectedNetwork()?.icon }}</mat-icon>
                      </div>
                      <div class="summary-card-content">
                        <span class="summary-card-title">{{ selectedNetwork()?.nombre }}</span>
                        <span class="summary-card-subtitle font-mono">{{ selectedNetwork()?.nombreCorto }}</span>
                      </div>
                    </div>
                  </div>
                  
                  <!-- Dispositivos -->
                  <div class="summary-section">
                    <h4 class="summary-section-title font-mono">
                      <mat-icon>devices</mat-icon>
                      ACTIVOS DETECTADOS
                    </h4>
                    <div class="summary-value-large font-display" [style.color]="networkColor()">
                      {{ defenseConfig()?.devicesDetected || selectedNetwork()?.dispositivos }}+
                    </div>
                    <span class="summary-value-label font-mono">dispositivos</span>
                  </div>
                  
                  <!-- Políticas -->
                  <div class="summary-section">
                    <h4 class="summary-section-title font-mono">
                      <mat-icon>policy</mat-icon>
                      POLÍTICAS ACTIVAS
                    </h4>
                    <div class="summary-value-large font-display" [style.color]="networkColor()">
                      {{ activePoliciesCount() }}
                    </div>
                    <span class="summary-value-label font-mono">módulos de seguridad</span>
                  </div>
                  
                  <!-- Nivel de alerta -->
                  <div class="summary-section">
                    <h4 class="summary-section-title font-mono">
                      <mat-icon>notifications</mat-icon>
                      NIVEL DE ALERTA
                    </h4>
                    <div class="summary-alert-level" [style.color]="getAlertLevelColor(alertLevel())">
                      <mat-icon>{{ alertLevel() === 'critico' ? 'error' : 'warning' }}</mat-icon>
                      <span class="font-display">{{ getAlertLevelLabel(alertLevel()) | uppercase }}</span>
                    </div>
                  </div>
                  
                  <!-- Clasificación -->
                  <div class="summary-section">
                    <h4 class="summary-section-title font-mono">
                      <mat-icon>security</mat-icon>
                      CLASIFICACIÓN
                    </h4>
                    <div class="summary-classification" [style.background]="classificationInfo().color">
                      <mat-icon>{{ classificationInfo().icon }}</mat-icon>
                      <span>{{ classificationInfo().label }}</span>
                    </div>
                  </div>
                  
                  <!-- Modelos ML -->
                  <div class="summary-section">
                    <h4 class="summary-section-title font-mono">
                      <mat-icon>psychology</mat-icon>
                      MODELOS ML
                    </h4>
                    <div class="summary-value-large font-display" [style.color]="networkColor()">
                      {{ mlModelsCount() }}
                    </div>
                    <span class="summary-value-label font-mono">algoritmos activos</span>
                  </div>
                </div>
                
                <!-- Barra de progreso de activación -->
                @if (isActivating()) {
                  <div class="activation-progress">
                    <div class="progress-header">
                      <span class="font-mono">ACTIVANDO SISTEMA...</span>
                      <span class="font-display">{{ activationProgress() }}%</span>
                    </div>
                    <div class="progress-bar">
                      <div 
                        class="progress-fill"
                        [style.width.%]="activationProgress()"
                        [style.background]="'linear-gradient(90deg, ' + networkColor() + ', ' + networkColor() + '80)'">
                      </div>
                    </div>
                  </div>
                }
              </div>
              
              <div class="card-footer">
                <button 
                  class="btn-sentinel btn-sentinel-secondary" 
                  [disabled]="isActivating()"
                  (click)="previousStep()">
                  <mat-icon>arrow_back</mat-icon>
                  Anterior
                </button>
                <button 
                  class="btn-sentinel btn-sentinel-primary btn-activate"
                  [disabled]="isActivating()"
                  [style.background]="!isActivating() ? 'linear-gradient(135deg, ' + networkColor() + ', ' + networkColor() + 'cc)' : ''"
                  (click)="startActivation()">
                  <mat-icon>{{ isActivating() ? 'hourglass_empty' : 'power_settings_new' }}</mat-icon>
                  {{ isActivating() ? 'Activando...' : 'Activar SENTINEL-ML' }}
                </button>
              </div>
            </div>
            
          } @else {
            <!-- Estado: Activación completada -->
            <div class="activation-success" @successAnimation>
              <div class="success-animation">
                <div class="success-circle" [style.background]="networkColor()">
                  <mat-icon>check</mat-icon>
                </div>
                <div class="success-rings">
                  <div class="ring ring-1" [style.border-color]="networkColor()"></div>
                  <div class="ring ring-2" [style.border-color]="networkColor()"></div>
                  <div class="ring ring-3" [style.border-color]="networkColor()"></div>
                </div>
              </div>
              
              <h2 class="success-title font-display">¡Sistema Activado!</h2>
              <p class="success-subtitle">SENTINEL-ML está protegiendo su red</p>
              
              <div class="success-details">
                <div class="success-stat">
                  <mat-icon [style.color]="networkColor()">{{ selectedNetwork()?.icon }}</mat-icon>
                  <span>{{ selectedNetwork()?.nombre }}</span>
                </div>
                <div class="success-stat">
                  <mat-icon [style.color]="networkColor()">security</mat-icon>
                  <span>{{ activePoliciesCount() }} políticas activas</span>
                </div>
                <div class="success-stat">
                  <mat-icon [style.color]="networkColor()">psychology</mat-icon>
                  <span>{{ mlModelsCount() }} modelos ML</span>
                </div>
              </div>
              
              <p class="redirect-text font-mono">Redirigiendo al dashboard en 2 segundos...</p>
              
              <button 
                class="btn-sentinel btn-sentinel-primary"
                [style.background]="'linear-gradient(135deg, ' + networkColor() + ', ' + networkColor() + 'cc)'"
                (click)="navigateToDashboard()">
                <mat-icon>dashboard</mat-icon>
                Ir al Dashboard Ahora
              </button>
            </div>
          }
        </div>
      }
    }
  </div>
</div>